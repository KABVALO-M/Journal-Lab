{% extends 'core/base.html' %}
{% load static %}
{% load tailwind_tags %}
{% block title %}JournoLab - Posts{% endblock %}

{% block content %}
<div class="flex flex-col md:flex-row">
    <!-- Posts Content -->
    <div class="content w-full md:w-3/4 h-[85-vh] overflow-y-auto p-5">
        <h2 class="text-3xl font-bold text-white mb-4">Posts</h2>
        
        <!-- Search Input Field -->
        <div class="mb-4">
            <input 
                type="text" 
                placeholder="Search posts..." 
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
        </div>

        <!-- Loop through the blogs -->
        {% for blog in blogs %}
        <div class="post-card bg-gray-100 p-4 mb-4 rounded-lg shadow-lg relative">
            <!-- Post Header -->
            <div class="flex items-center justify-between">
                <!-- Profile Picture, Name, and Date -->
                <div class="flex items-center space-x-4">
                    <!-- Profile Picture -->
                    <img 
                        src="{% static 'images/profile-placeholder.png' %}" 
                        alt="Profile picture" 
                        class="w-16 h-16 rounded-full"
                    >
                    <!-- Name and Date -->
                    <div>
                        <p class="text-lg font-semibold text-gray-900">{{ blog.author.username }}</p>
                        <p class="text-sm text-gray-500">Posted on {{ blog.created_at|date:"F d, Y" }}</p>
                    </div>
                </div>
                
                <!-- Dismiss Button -->
                <button 
                    class="text-gray-400 hover:text-gray-700 focus:outline-none" 
                    onclick="this.parentElement.parentElement.remove()" 
                    aria-label="Dismiss post"
                >
                <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            
            <!-- Post Content -->
            <div class="mt-4">
                <p class="text-gray-800">
                    {{ blog.content|truncatechars:350 }}
                    <a href="{% url 'core:post_detail' blog.id %}" class="text-blue-500 hover:underline">Read More</a>
                </p>
            </div>
            
            <!-- Media Thumbnail Section -->
            <div class="mt-4">
                {% if blog.image %}
                    <!-- Image Thumbnail -->
                    <img 
                        src="{{ blog.image.url }}" 
                        alt="Post image thumbnail" 
                        class="w-full h-auto rounded-lg shadow-md"
                    >
                {% elif blog.video %}
                    <!-- Video Thumbnail -->
                    <video 
                        controls 
                        class="w-full h-auto rounded-lg shadow-md"
                    >
                        <source src="{{ blog.video.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                {% endif %}
            </div>

            <!-- Likes and Comments Count -->
            <div class="flex justify-between items-center mt-4">
                <div class="text-gray-700">
                    <span>{{ blog.likedislikes.count }} Likes</span>
                    <span class="ml-4">{{ blog.comments.count }} Comments</span>
                </div>
            </div>

            <!-- Horizontal Rule -->
            <hr class="border-t-2 border-gray-300 my-2">

            <!-- Like and Comments Buttons -->
            <div class="flex justify-start items-center mt-2">
                <button class="like-button text-blue-500 hover:text-blue-700 mr-4" onclick="likePost('{{ blog.id }}')">
                    <i class="fa-solid fa-thumbs-up"></i> Like
                </button>
                <button class="comments-button text-blue-500 hover:text-blue-700" onclick="window.location.href='{% url 'core:post_detail' blog.id %}'">
                    <i class="fa-solid fa-comments"></i> Comments
                </button>
            </div>
        </div>
        {% empty %}
            <p>No blog posts available.</p>
        {% endfor %}
    </div>

    <!-- Trending Stories Sidebar -->
    <div class="trending-stories w-full md:w-1/4 p-5 bg-gray-800 text-white rounded-lg shadow-lg md:mr-5 mt-5 overflow-y-auto">
        <h2 class="text-2xl font-bold mb-4">Trending Stories</h2>
        <div class="space-y-6">
            <!-- Loop through trending blogs -->
            {% for trending_blog in trending_blogs %}
            <div class="trending-item bg-gray-700 p-4 rounded-lg shadow-md">
                <!-- Image Section -->
                {% if trending_blog.image %}
                <img 
                    src="{{ trending_blog.image.url }}" 
                    alt="Trending story image" 
                    class="w-full h-32 object-cover rounded-t-lg mb-3"
                >
                {% else %}
                <img 
                    src="{% static 'images/default-trending.png' %}" 
                    alt="Default trending story image" 
                    class="w-full h-32 object-cover rounded-t-lg mb-3"
                >
                {% endif %}
                <!-- Content Section -->
                <div>
                    <h3 class="text-lg font-semibold mb-2">{{ trending_blog.title }}</h3>
                    <p class="text-xs text-gray-300 mb-2">
                        By {{ trending_blog.author.username }} on {{ trending_blog.created_at|date:"F d, Y" }}
                    </p>
                    <p class="text-gray-200 text-sm">
                        {{ trending_blog.content|truncatechars:100 }}
                        <a href="{% url 'core:post_detail' trending_blog.id %}" class="text-blue-400 hover:underline">Read More</a>
                    </p>
                </div>
            </div>
            {% empty %}
                <p>No trending stories available.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
