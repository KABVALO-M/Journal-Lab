{% extends 'core/base.html' %}
{% load static %}
{% load tailwind_tags %}

{% block title %}JournoLab - Mentorship{% endblock %}

{% block content %}
    <!-- Scrollable Content Area -->
    <div class="content h-[67vh] overflow-y-auto p-5">  
        <h1 class="text-4xl font-bold text-white mb-6">Mentorship Program</h1>
        <p class="text-white text-lg mb-6">
            Welcome to the JournoLab Mentorship Program. Our mentorship program connects experienced professionals with aspiring individuals eager to grow in their careers.
        </p>

        <!-- Two-column Layout -->
        <div class="flex flex-wrap -mx-4">
            <!-- Left Column: Previous Chats -->
            <div class="w-full lg:w-2/3 px-4">
                <div class="mb-4">
                    <input 
                        type="text" 
                        placeholder="Search mentorship chats..." 
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-black"
                        oninput="filterChats(this.value)"
                    />
                </div>

                <div class="bg-gray-50 rounded-lg shadow-lg p-5">  
                    <h2 class="text-3xl font-bold text-black mb-4">Previous Chats</h2>
                    <div class="h-[63vh] overflow-y-auto p-5">  
                        {% for chat in chats %}
                            {% if chat.id %}  <!-- Check if chat.id exists -->
                                <a href="{% url 'core:chat_detail' chat.id 'chat_id' %}" class="chat-card bg-[#000080] p-4 mb-4 rounded-lg shadow-lg relative block">
                                    <div class="flex justify-between items-center">
                                        <h3 class="text-sm font-semibold text-white">
                                            {% if user == chat.participant_one %}
                                                {{ chat.participant_two.first_name }} {{ chat.participant_two.last_name }}
                                            {% else %}
                                                {{ chat.participant_one.first_name }} {{ chat.participant_one.last_name }}
                                            {% endif %}
                                        </h3>
                                        <p class="text-sm text-white">{{ chat.last_message_date|date:"F d, Y" }}</p>
                                    </div>
                                    <div class="flex justify-between items-center mt-1">
                                        <p class="text-white mt-2">{{ chat.last_message|default:"No messages yet." }}</p>

                                        <!-- Unread Message Count -->
                                        {% if chat.unread_count > 0 %}
                                            <span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full ml-2">
                                                {{ chat.unread_count }}
                                            </span>
                                        {% endif %}
                                    </div>
                                </a>
                            {% else %}
                                <p>No valid chat ID.</p>
                            {% endif %}
                        {% empty %}
                            <p>No chats available.</p>
                        {% endfor %}

                    </div>
                </div>                               
            </div>

            <!-- Right Column: Available Mentors -->
            <div class="w-full lg:w-1/3 px-4">
                <div class="bg-gray-50 rounded-lg shadow-lg p-5">  
                    <h2 class="text-3xl font-bold text-black mb-4">Available Mentors</h2>
                    <div class="h-[67vh] overflow-y-auto p-5">  
                        {% for mentor in mentors %}
                            {% if mentor.id != request.user.id %}  <!-- Exclude logged-in user -->
                                <a href="{% url 'core:chat_detail' mentor.id 'recipient_id' %}" class="mentor-card bg-[#000080] p-4 mb-4 rounded-lg shadow-lg block">
                                    <div class="flex items-center space-x-4">
                                        <img 
                                            src="{% if mentor.profile_image %}{{ mentor.profile_image.url }}{% else %}{% static 'images/profile-placeholder.png' %}{% endif %}" 
                                            alt="Mentor profile picture" 
                                            class="w-16 h-16 rounded-full"
                                        >
                                        <div>
                                            <h3 class="text-sm font-semibold text-white">{{ mentor.first_name }} {{ mentor.last_name }}</h3>
                                            <p class="text-white text-sm">{{ mentor.username }}</p>
                                        </div>
                                    </div>
                                    <p class="text-white mt-2">{{ mentor.bio|truncatewords:20 }}</p>
                                </a>
                            {% endif %}
                        {% empty %}
                            <p class="text-black">No mentors available.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
